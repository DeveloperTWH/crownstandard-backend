Crownstandard API Development Phase

You are working on a full-stack platform called Crownstandard, a cleaning-services marketplace similar to *Urban Company* but focused exclusively on cleaning services.
We have already finalized the entire backend data architecture and models, and now weâ€™re starting the API layer development phase.

---

ğŸ“¦ Project Summary (Backend)

ğŸ¯ Platform Roles:

* ğŸ‘¤ Customer: Book services, upload place photos, pay online, tip providers, leave reviews, and raise disputes.
* ğŸ§‘â€ğŸ”§ Service Provider: List services, accept bookings, perform jobs, receive payouts, and manage availability.
* ğŸ§‘â€ğŸ’¼ Admin: Approve providers, resolve disputes, control payouts, manage visibility of services/reviews, and send platform-wide notifications.

ğŸ§± Tech Stack:

* Backend: Node.js + Express.js
* Database: MongoDB (Mongoose ODM)
* Payments: Stripe (Connect, PaymentIntent, Transfer, Refund APIs)
* Auth: JWT + optional OAuth (Google/Apple)
* Storage: AWS S3 for images (booking photos, review media, evidence)

---

ğŸ“ âœ… Completed: Data Models

All backend models are designed, reviewed, and finalized:

1. User â€“ unified model with provider/customer/admin profiles
2. ServiceCategory â€“ categories of cleaning services
3. Service â€“ provider-listed cleaning services
4. Booking â€“ core transaction unit with OTP verification
5. PaymentTransaction â€“ main booking payment
6. TipTransaction â€“ separate tip payments
7. Review â€“ post-service customer feedback
8. Dispute â€“ complaint handling and refund workflow
9. Notification â€“ in-app and push notification logs
10. AuditLog â€“ admin/system actions for traceability

All relationships, indexes, and references are properly mapped.

---

ğŸ“ Current Status

âœ… Schema Layer: 100% complete
âœ… Data relationships: Finalized and documented
âœ… Business Logic: Defined (payouts, disputes, tips, cancellation rules, etc.)
âœ… Auth Flows: Login, Forgot Password, and Dashboard linking are implemented

ğŸ§­ Next: Start building the API layer

---

ğŸš€ API Development Plan (Where to Start)

We will now implement RESTful API routes module by module, following this sequence:

---

1. ğŸ” Auth & User APIs

* POST /auth/register â€” Register customer or provider
* POST /auth/login â€” JWT-based login
* POST /auth/forgot-password / POST /auth/reset-password â€” Password reset
* GET /auth/me â€” Get current user profile
* PUT /auth/me â€” Update profile
* POST /auth/oauth/google â€” Google login (optional)

---

2. ğŸ‘¤ User Management APIs

* GET /users/:id â€” Fetch user details (admin)
* PUT /users/:id/approve â€” Approve/reject provider
* PUT /users/:id/status â€” Suspend/reactivate account
* GET /providers â€” List approved providers

---

3. ğŸ§¹ Service & Category APIs

* POST /categories / GET /categories â€” Manage categories
* POST /services / GET /services / PUT /services/:id â€” CRUD operations
* GET /services?location&price&rating â€” Filtered search
* PATCH /services/:id/visibility â€” Admin show/hide service

---

4. ğŸ“… Booking APIs

* POST /bookings â€” Create booking (requires photos)
* GET /bookings / GET /bookings/:id â€” Retrieve bookings
* PATCH /bookings/:id/cancel â€” Cancel booking (apply policy)
* PATCH /bookings/:id/accept â€” Provider accepts booking
* PATCH /bookings/:id/complete â€” OTP verification to complete booking

---

5. ğŸ’³ Payment & Tip APIs

* POST /payments/create-intent â€” Create PaymentIntent (booking)
* POST /payments/webhook â€” Handle Stripe events
* GET /payments/:bookingId â€” Get payment details
* POST /tips/create-intent â€” Create Tip PaymentIntent
* POST /tips/refund â€” Refund tip
* POST /payments/refund â€” Refund booking (admin only)

---

6. â­ Review APIs

* POST /reviews â€” Submit a review (only after completion)
* GET /reviews?serviceId= â€” Fetch reviews for a service
* PATCH /reviews/:id/hide â€” Admin hides review

---

7. âš–ï¸ Dispute APIs

* POST /disputes â€” Raise a dispute
* GET /disputes / GET /disputes/:id â€” List or view disputes
* PATCH /disputes/:id/resolve â€” Admin resolves (refund/no refund)

---

8. ğŸ”” Notification APIs

* GET /notifications â€” Fetch notifications for a user
* PATCH /notifications/:id/read â€” Mark as read
* POST /notifications â€” Send custom notification (admin)

---

9. ğŸ§¾ AuditLog APIs

* GET /audit-logs â€” View system/admin activity
* GET /audit-logs/:id â€” Inspect specific event details

---

ğŸ’¸ Business Rules (Implemented at API level)

* Platform commission: 25% per booking
* Provider payout: 75% (released automatically after 48h dispute window unless on hold)
* Tip payout: 100% to provider (refundable via dispute system)
* Cancellation policy: Free before provider accepts, 15% fee after
* Dispute: Must be raised within 48h after completion
* Refunds: Full or partial, handled via Stripe and linked to Dispute resolution

---

ğŸ“Š Recommended API Design Practices

* Use JWT middleware for route protection and role-based access.
* Use Mongoose populate() for related data (service, provider, customer, etc.).
* Add pagination & filters for all list endpoints.
* Create a Stripe webhook handler to update PaymentTransaction and TipTransaction statuses automatically.
* Implement admin-level routes under /admin/* with role verification.
* Log every sensitive action in AuditLog.

---

ğŸ“ Where to Start Now

âœ… All database models are ready.
âœ… Business logic and payment flows are finalized.

ğŸ‘‰ Start coding from the Auth & User APIs module (/auth/*, /users/*), then progress through services â†’ bookings â†’ payments â†’ disputes.

---

Goal: Use the above context to start writing production-grade Express.js APIs for Crownstandard. Focus first on the authentication and user onboarding layer, then move toward service listing and booking creation.

